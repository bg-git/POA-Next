{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/POA%20Next/apps/storefront/src/pages/api/shopify/blog/articles.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\r\n\r\nconst SHOPIFY_DOMAIN = process.env.SHOPIFY_STORE_DOMAIN || '';\r\nconst SHOPIFY_STOREFRONT_TOKEN = process.env.SHOPIFY_STOREFRONT_ACCESS_TOKEN || '';\r\n\r\ninterface ShopifyBlogArticle {\r\n  id: string;\r\n  title: string;\r\n  handle: string;\r\n  excerpt?: string;\r\n  content: string;\r\n  publishedAt: string;\r\n  image?: {\r\n    url: string;\r\n    altText?: string;\r\n  };\r\n  author?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface ShopifyGraphQLArticle {\r\n  id: string;\r\n  title: string;\r\n  handle: string;\r\n  excerpt?: string;\r\n  contentHtml: string;\r\n  publishedAt: string;\r\n  image?: {\r\n    url: string;\r\n    altText?: string;\r\n  };\r\n  author?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface ApiResponse {\r\n  articles?: ShopifyBlogArticle[];\r\n  error?: string;\r\n}\r\n\r\n// Fetch all articles from a specific blog\r\nasync function fetchBlogArticles(\r\n  handle: string = 'magazine',\r\n  limit: number = 250\r\n): Promise<ShopifyBlogArticle[]> {\r\n  const query = `\r\n    {\r\n      blog(handle: \"${handle}\") {\r\n        articles(first: ${limit}) {\r\n          edges {\r\n            node {\r\n              id\r\n              title\r\n              handle\r\n              excerpt\r\n              contentHtml\r\n              publishedAt\r\n              image {\r\n                url\r\n                altText\r\n              }\r\n              author {\r\n                name\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  `;\r\n\r\n  const response = await fetch(`https://${SHOPIFY_DOMAIN}/api/2024-01/graphql.json`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-Shopify-Storefront-Access-Token': SHOPIFY_STOREFRONT_TOKEN,\r\n    },\r\n    body: JSON.stringify({ query }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Shopify API error: ${response.status}`);\r\n  }\r\n\r\n  const data = await response.json();\r\n\r\n  if (data.errors) {\r\n    throw new Error(`GraphQL error: ${data.errors[0].message}`);\r\n  }\r\n\r\n  return data.data?.blog?.articles?.edges?.map((edge: { node: ShopifyGraphQLArticle }) => ({\r\n    id: edge.node.id,\r\n    title: edge.node.title,\r\n    handle: edge.node.handle,\r\n    excerpt: edge.node.excerpt || '',\r\n    content: edge.node.contentHtml || '',\r\n    publishedAt: edge.node.publishedAt,\r\n    image: edge.node.image,\r\n    author: edge.node.author,\r\n  })) || [];\r\n}\r\n\r\n// Fetch a single article by handle\r\nasync function fetchArticleByHandle(\r\n  handle: string,\r\n  blogHandle: string = 'magazine'\r\n): Promise<ShopifyBlogArticle | null> {\r\n  const query = `\r\n    {\r\n      blog(handle: \"${blogHandle}\") {\r\n        articleByHandle(handle: \"${handle}\") {\r\n          id\r\n          title\r\n          handle\r\n          excerpt\r\n          contentHtml\r\n          publishedAt\r\n          image {\r\n            url\r\n            altText\r\n          }\r\n          author {\r\n            name\r\n          }\r\n        }\r\n      }\r\n    }\r\n  `;\r\n\r\n  const response = await fetch(`https://${SHOPIFY_DOMAIN}/api/2024-01/graphql.json`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-Shopify-Storefront-Access-Token': SHOPIFY_STOREFRONT_TOKEN,\r\n    },\r\n    body: JSON.stringify({ query }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Shopify API error: ${response.status}`);\r\n  }\r\n\r\n  const data = await response.json();\r\n\r\n  if (data.errors) {\r\n    console.error('GraphQL error:', data.errors);\r\n    throw new Error(`GraphQL error: ${data.errors[0].message}`);\r\n  }\r\n\r\n  const article = data.data?.blog?.articleByHandle;\r\n  if (!article) return null;\r\n\r\n  console.log('Article content received:', {\r\n    title: article.title,\r\n    hasContent: !!article.contentHtml,\r\n    contentLength: article.contentHtml?.length || 0,\r\n  });\r\n\r\n  return {\r\n    id: article.id,\r\n    title: article.title,\r\n    handle: article.handle,\r\n    excerpt: article.excerpt || '',\r\n    content: article.contentHtml || article.content || '',\r\n    publishedAt: article.publishedAt,\r\n    image: article.image,\r\n    author: article.author,\r\n  };\r\n}\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<ApiResponse>\r\n) {\r\n  if (req.method !== 'GET') {\r\n    return res.status(405).json({ error: 'Method not allowed' });\r\n  }\r\n\r\n  try {\r\n    const { handle, blog = 'magazine' } = req.query;\r\n\r\n    if (handle) {\r\n      // Fetch single article\r\n      const article = await fetchArticleByHandle(handle as string, blog as string);\r\n      if (!article) {\r\n        return res.status(404).json({ error: 'Article not found' });\r\n      }\r\n      return res.status(200).json({ articles: [article] });\r\n    } else {\r\n      // Fetch all articles\r\n      const articles = await fetchBlogArticles(blog as string);\r\n      return res.status(200).json({ articles });\r\n    }\r\n  } catch (error) {\r\n    console.error('Blog fetch error:', error);\r\n    return res.status(500).json({ error: 'Failed to fetch blog articles' });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}